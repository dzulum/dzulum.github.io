if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }

__d("LSClearMessagePlaceholderRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.ftr(b.db.table(13).fetch([[[a[0],[0,0]]]]),function(c){return b.i64.eq(c.a,a[0])&&c.c===a[1]&&b.i64.eq([0,0],c.b)&&b.i64.eq([0,0],c.d)}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSGetEncryptionVersionFromSupportedVersionsList.bs",["LSResult.bs","Promise","bs_caml","bs_caml_array","bs_caml_int64","bs_caml_obj","bs_int64"],(function(a,b,c,d,e,f){"use strict";var g=b("bs_caml_int64").zero;function h(a,c){if(c.length>0&&!b("bs_caml_obj").caml_greaterthan(a,b("bs_caml_array").get(c,0)))return b("bs_caml_array").get(c,0);else return a}function i(a,c){if(c.length>0&&b("bs_caml_obj").caml_greaterthan(a,b("bs_caml_array").get(c,0)))return b("bs_caml_array").get(c,0);else return a}function j(a,c){return a.filter(function(a){return c.reduce(function(c,d){if(c)return!0;else return b("bs_int64").equal(d,a)},!1)})}function k(a){while(!0){var c=a,d=c.reduce(j,b("bs_caml_array").get(c,0));if(d.length>0)return b("bs_caml_array").get(d.sort(function(a,c){return b("bs_int64").compare(c,a)}),0);d=c.reduce(i,b("bs_int64").max_int);c=c.reduce(function(a){return function(c,d){d=d.filter(function(c){return b("bs_caml").i64_gt(c,a)});if(d.length>0)return c.concat([d]);else return c}}(d),[]);if(c.length<=0)return d;a=c;continue}}function a(a,c,d){a=d.map(function(a){return a});var e=a.reduce(h,g);c=a.map(function(a){return a.filter(function(a){return b("bs_caml").i64_ge(a,e)})}).filter(function(a){return a.length>0});return b("Promise").resolve(b("LSResult.bs").make(k(c)))}f.defaultVersion=g;f.getHighestMinimum=h;f.getMinimum=i;f.intersectFunction=j;f.recursiveFind=k;f.call=a}),null);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.bs","LSCreateAuthKeyPair.bs","LSCreateDataTraceID.bs","LSCreateDerivedKeys.bs","LSCreateEncryptionKeyPair.bs","LSCreateSignatureKeyPair.bs","LSCreateSignature_v2.bs","LSDeleteBackupOnClient","LSGetBlobFromString.bs","LSGetEncryptionVersionFromSupportedVersionsList.bs","LSHmac_v2.bs","LSIssueNewTask","LSOcmfClientEvolve_v2.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])&&c.i64.eq(a.m,[0,2])}),0,c.i64.to_float([0,1])).next().then(function(a,b){b=a.done;a=a.value;return b?d[0]=!1:(a.item,d[0]=!0)})},function(a){return d[0]?d[2]=c.i64.or_([0,71],[0,128]):d[2]=[0,71],c.nop(b("LSCreateDataTraceID.bs")).then(function(a){return a=a,d[3]=a[0],a})},function(a){return d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils]",d[4],"EncryptedBackups Trace ID",d[4],c.i64.to_string(d[2])].join("")),c.db.table(153).add({a:d[3],b:c.i64.of_float(Date.now()),d:d[2],e:!1,h:"backup_init_flow"})},function(a){return d[7]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[7]||a.g===d[7]||a.h===d[7]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[8]=f:(b=a.item,d[8]=b.a)})},function(a){return d[5]=d[8]}])},function(a){return d[5]!==f?c.sp(b("LSAppendDataTraceAddon"),d[5],[0,1434],[0,2],f,f):c.resolve()},function(e){return c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}).next().then(function(e,g){g=e.done;e=e.value;return g?c.seq([function(a){return c.db.table(168).fetch().next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.sp(b("LSDeleteBackupOnClient"),d.a))})},function(a){return c.nop(b("LSCreateSignatureKeyPair.bs")).then(function(a){return a=a,d[9]=a[0],d[10]=a[1],a})},function(a){return c.nop(b("LSCreateEncryptionKeyPair.bs")).then(function(a){return a=a,d[11]=a[0],d[12]=a[1],a})},function(a){return c.nop(b("LSCreateSignature_v2.bs"),d[9],c.blob("MA=="),d[12]).then(function(a){return a=a,d[13]=a[0],a})},function(a){return c.nop(b("LSCreateAuthKeyPair.bs")).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(a){return c.nop(b("LSCreateSignature_v2.bs"),d[9],c.blob("MQ=="),d[15]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[17]=a[0].get("add_peer_epoch_data"),a[0],c.ntop("Array",b("LSArrayGetObjectAt"),d[17],[0,0]).then(function(a){return a=a,d[18]=a[0],d[19]=a[1],a})},function(a){return d[20]=d[18].get("epoch_anon_id"),d[18],d[21]=d[18].get("epoch_root_key"),d[18],d[22]=c.createArray(),d[38]=(d[22].push([0,32]),d[22]),c.nop(b("LSBase64Encode.bs"),d[20]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]!==f?c.seq([function(a){return c.nop(b("LSCreateDerivedKeys.bs"),c.blobs.of_string(["epoch_devices","_",d[23]].join("")),f,d[21],d[22]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[38],[0,0]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return d[24]=d[39]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[24]=d[38]}])},function(a){return c.nop(b("LSHmac_v2.bs"),d[24],d[10]).then(function(a){return a=a,d[25]=a[0],a})},function(e){return d[26]=a[0].get("backup_id"),a[0],d[27]=c.createArray(),d[38]=(d[27].push([0,0]),d[27]),d[38]=(d[27].push([0,2]),d[27]),d[28]="",d[29]=c.i64.of_int32(d[27].length),c.i64.gt(d[29],[0,0])?c.loopAsync(d[29],function(a){return d[38]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[27],d[38]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return d[28]=[d[28],"_",c.i64.to_string(d[39])].join("")}])}):c.resolve()},function(a){return c.nop(b("LSGetBlobFromString.bs"),["supported_versions_",d[28],"revision_version_",c.i64.to_string([0,1])].join("")).then(function(a){return a=a,d[30]=a[0],a})},function(a){return c.nop(b("LSCreateSignature_v2.bs"),d[9],c.blob("Mg=="),d[30]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.blobs.neq(d[31],f)?c.seq([function(a){return c.nop(b("LSBase64Encode.bs"),d[31]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[32]=d[38]}]):c.resolve(d[32]=f)},function(a){return d[33]=c.createArray(),c.fe(c.ftr(c.db.table(191).fetch(),function(a){return c.i64.eq(d[26],a.a)}),function(a){var b=a.item;return c.seq([function(a){return d[38]=c.createArray(),c.fe(c.db.table(192).fetch([[[b.b]]]),function(a){a=a.item;return d[40]=(d[38].push(a.b),d[38])})},function(a){return d[39]=c.i64.of_int32(d[38].length),c.i64.gt(d[39],[0,0])?d[40]=(d[33].push(d[38]),d[33]):0}])})},function(a){return d[34]=c.createArray(),d[38]=(d[34].push([0,0]),d[34]),d[38]=(d[34].push([0,2]),d[34]),d[35]=c.createArray(),d[36]=c.i64.of_int32(d[34].length),c.i64.gt(d[36],[0,0])?c.loopAsync(d[36],function(a){return d[38]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[34],d[38]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return d[41]=(d[35].push(d[39]),d[35])}])}):c.resolve()},function(a){return d[38]=(d[33].push(d[35]),d[33]),c.nop(b("LSGetEncryptionVersionFromSupportedVersionsList.bs"),d[33]).then(function(a){return a=a,d[37]=a[0],a})},function(e){return c.blobs.neq(d[25],f)?c.seq([function(e){return d[38]=a[0].get("temp_ocmf_client_state"),a[0],c.nop(b("LSOcmfClientEvolve_v2.bs"),d[38]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(b){return d[42]=a[0].get("mailbox_root_key"),a[0],d[43]=a[0].get("oblivious_validation_token"),a[0],c.fe(c.ftr(c.db.table(168).fetch([[[d[26]]]]),function(a){return c.i64.eq(a.a,d[26])&&c.i64.lt(a.i,[0,20])}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({a:d[26],b:d[10],c:d[9],d:d[12],e:d[11],l:d[15],k:d[14],f:d[42],g:d[39],h:d[43],i:[0,20],m:[0,1],o:[0,1],n:d[37]})},function(b){return d[44]=d[18].get("epoch_id"),d[18],d[45]=a[0].get("backup_id"),a[0],d[46]=d[18].get("epoch_anon_id"),d[18],d[47]=d[18].get("epoch_root_key"),d[18],c.fe(c.ftr(c.db.table(169).fetch([[[d[44]]]]),function(a){return c.i64.eq(a.a,d[44])&&c.i64.lt(a.f,[0,20])}),function(a){return a["delete"]()})},function(a){return c.db.table(169).add({a:d[44],f:[0,20],b:d[45],c:d[46],d:d[47],e:[0,1]})},function(a){return c.nop(b("LSBase64Encode.bs"),d[10]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[25]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[12]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[13]==null?c.blob("bnVsbA=="):d[13]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[15]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[16]==null?c.blob("bnVsbA=="):d[16]).then(function(a){return a=a,d[53]=a[0],a})},function(e){return d[54]=a[0].get("backup_id"),a[0],d[55]=a[0].get("server_data_id"),a[0],d[56]=new c.Map(),d[56].set("supported_encryption_versions",d[27]),d[56].set("client_version",[0,1]),d[56].set("version_sig",d[32]==null?"":d[32]),d[57]=new c.Map(),d[57].set("backup_id",d[54]),d[57].set("device_epoch_hmac",d[49]==null?"":d[49]),d[57].set("device_public_key",d[48]==null?"":d[48]),d[57].set("epoch_auth_pubkey",d[52]==null?"":d[52]),d[57].set("epoch_auth_pubkey_sig",d[53]==null?"":d[53]),d[57].set("epoch_storage_pubkey",d[50]==null?"":d[50]),d[57].set("epoch_storage_pubkey_sig",d[51]==null?"":d[51]),d[57].set("ocmf_rotation_token",d[41]==null?"":d[41]),d[57].set("server_data_id",d[55]),d[57].set("device_registration_id",a[1]),d[57].set("encryption_version_data",d[56]),d[58]=c.toJSON(d[57]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50017],d[58],f,f,[0,0],f)}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure]$device_epoch_hmac found to be null"))}]):(e.item,function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure]An authoritative row already exists, aborting execution of add peer device"))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSInsertNewMessageRange",["LSClearMessagePlaceholderRange"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[];return c.seq([function(e){return c.seq([function(d){return c.sp(b("LSClearMessagePlaceholderRange"),a[0],a[9])},function(b){return c.ftr(c.db.table(13).fetch([[[a[0],{lte:a[5]}]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.le(b.b,a[5])&&c.i64.ge(b.d,a[5])}).next().then(function(b,c){var e=b.done;b=b.value;return e?(e=[a[1],a[3],a[7]],d[0]=e[0],d[1]=e[1],d[2]=e[2],e):(c=b.item,e=[c.b,c.c,c.h],d[0]=e[0],d[1]=e[1],d[2]=e[2],e)})},function(b){return c.ftr(c.db.table(13).fetch([[[a[0],{lte:a[6]}]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.le(b.b,a[6])&&c.i64.ge(b.d,a[6])}).next().then(function(b,c){var e=b.done;b=b.value;return e?(e=[a[2],a[4],a[8]],d[4]=e[0],d[5]=e[1],d[6]=e[2],e):(c=b.item,e=[c.d,c.e,c.i],d[4]=e[0],d[5]=e[1],d[6]=e[2],e)})},function(b){return c.fe(c.ftr(c.db.table(13).fetch([[[a[0],{lte:a[6]}]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.ge(a[6],b.b)&&c.i64.le(a[5],b.d)}),function(a){return a["delete"]()})},function(b){return c.db.table(13).put({a:a[0],b:d[0],c:d[1],d:d[4],e:d[5],f:!1,g:!1,h:d[2],i:d[6]})}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSIssueAttachmentBackupTask",["LSBase64Encode.bs","LSGetBlobFromString.bs","LSHmac_v2.bs","LSIssueNewTask","LSOcmfClientMap.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[f,f,f,f,f],d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[4]=c[4],c):(b=a.item,c=[b.a,b.j,b.f,b.g,b.n],d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[4]=c[4],c)})},function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFindBackupStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var e=a.done;a=a.value;return e?d[7]=f:(b=a.item,d[7]=c.i64.to_string(b.a))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFindBackupStoredProcedure]Finishing execution."),d[6]=d[7]}])},function(e){return c.blobs.neq(d[3],f)?c.i64.neq(d[1],f)?d[6]!==f?c.seq([function(e){return d[7]=c.createArray(),d[19]=(d[7].push(d[6]),d[7]),d[19]=(d[7].push(a[0]),d[7]),d[8]=c.toJSON(d[7]),c.nop(b("LSGetBlobFromString.bs"),d[8]).then(function(a){return a=a,d[9]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.bs"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[9]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.bs"),d[3],d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(a){return c.nop(b("LSGetBlobFromString.bs"),d[6]).then(function(a){return a=a,d[13]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.bs"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[13]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.bs"),d[3],d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[15]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[17]=new c.Map(),d[17].set("attachment_index_key",d[12]==null?"":d[12]),d[17].set("delivery_object_id",a[0]),d[17].set("device_id",d[1]),d[17].set("mailbox_partial_id",d[16]==null?"":d[16]),d[17].set("media_type",a[2]),d[17].set("product_type",a[1]),d[18]=c.toJSON(d[17]),c.sp(b("LSIssueNewTask"),"encrypted_backups_attachment_upload",[0,50012],d[18],f,f,[0,0],f)}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure]Missing backup_id for IssueAttachmentBackupTask")):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure]Missing device_id for IssueAttachmentBackupTask")):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure]Missing ocmf_client_state_blob for IssueAttachmentBackupTask"))},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSUploadMessage",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadMessageStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[f,f,f,f,f],d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[4]=c[4],c):(b=a.item,c=[b.a,b.j,b.f,b.g,b.n],d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[4]=c[4],c)})},function(e){return c.i64.neq(d[0],f)&&c.i64.neq(d[1],f)&&c.blobs.neq(d[3],f)&&!0?c.seq([function(a){return c.sp(b("LSIssueNewTaskAndGetTaskID"),"encrypted_backups_upload",[0,319],"",f,f,[0,0],[0,93]).then(function(a){return a=a,d[6]=a[0],a})},function(b){return c.i64.eq(d[6],[-1,4294967295])?c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsUploadMessageStoredProcedure]issueNewTaskAndGetTaskIdFromParams failed")):c.db.table(177).add({a:void 0,b:d[6],c:"",d:[0,1],e:[0,1],f:[0,1],g:a[0],h:a[1],i:c.i64.to_string(a[2]),j:a[3]})}]):c.resolve()},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadMessageStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSUploadThread",["LSIssueNewTaskAndGetTaskID","LSSerializeThreadListKey"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadThreadStoredProcedure]Beginning execution."),c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}).next().then(function(e,g){var h=e.done;e=e.value;return h?function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadThreadStoredProcedure]backup_id is not available"):(g=e.item,c.seq([function(e){return c.sp(b("LSSerializeThreadListKey"),a[1],c.i64.to_string(g.a),a[2]).then(function(a){return a=a,d[1]=a[0],a})},function(a){return c.sp(b("LSIssueNewTaskAndGetTaskID"),"encrypted_backups_upload",[0,319],"",f,f,[0,0],[0,93]).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.i64.eq(d[2],[-1,4294967295])?c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsUploadThreadStoredProcedure]issueNewTaskAndGetTaskIdFromParams failed")):c.db.table(177).add({a:void 0,b:d[2],c:"",d:[0,1],e:[0,2],f:[0,1],g:d[1],h:a[0],i:c.i64.to_string(a[3]),j:a[4]})}]))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadThreadStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.seq([function(c){return b.fe(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({a:a[0],b:a[1],c:a[2],d:[2328,1316134911],g:a[3],h:!1,e:!1,f:!1})}])},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("MAWBridgeAbPropsUpdatedHandler.bs",["MAWAbPropsClient.bs"],(function(a,b,c,d,e,f){"use strict";function a(a){b("MAWAbPropsClient.bs").rewrite(a);return window.Promise.resolve(void 0)}f.call=a}),null);
__d("MAWBridgeCallFinishAddDeviceHandler.bs",["LS.bs","LSDict","LSFinishAddPeerDevice","LSVec.bs","MWChatQRCodeEventEmitter","MessengerWebInitData","bs_caml_format"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return b("LSFinishAddPeerDevice")(b("LSDict").fromObject({backup_id:b("bs_caml_format").caml_int64_of_string(c.backupId),server_data_id:b("bs_caml_format").caml_int64_of_string(c.serverDataId),temp_ocmf_client_state:c.tempOcmfClientState,mailbox_root_key:c.mailboxRootKey,oblivious_validation_token:c.obliviousValidationToken,add_peer_epoch_data:b("LSVec.bs").make(c.epoch.map(function(a){return b("LSDict").fromObject(a)}))}),b("MessengerWebInitData").sessionId,b("LS.bs").make(a))}function a(a,c){return g(a,c).then(function(a){b("MWChatQRCodeEventEmitter").emit()})}f.sprocCall=g;f.call=a}),null);
__d("MAWBridgeClockSkewUpdatedHandler.bs",["WATimeUtils"],(function(a,b,c,d,e,f){"use strict";function a(a,c){b("WATimeUtils").setClockSkew(c);return window.Promise.resolve(void 0)}f.call=a}),null);
__d("MAWBridgeDeleteReactionHandler.bs",["MAWThreadId.bs","ReQLTable","bs_caml_format"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){return b("ReQLTable").table(a,"reactions")["delete"]({hd:d,tl:{hd:c.messageId,tl:{hd:b("bs_caml_format").caml_int64_of_string(c.actorId),tl:0}}})})}function a(a,b){return g(a,b).then(function(a){})}f.call=a}),null);
__d("MAWBridgeDropAllSecureThreadsHandler.bs",["LSMessagingThreadTypeUtil.bs","Promise","ReQL.bs","ReQLTable"],(function(a,b,c,d,e,f){"use strict";function g(a){return b("ReQL.bs").toArray(b("ReQL.bs").filter(b("ReQLTable").table(a,"threads").asc,function(a){return b("LSMessagingThreadTypeUtil.bs").isSecure(a.c)})).then(function(c){return c.reduce(function(c,d){return c.then(function(c){return b("ReQLTable").table(a,"threads")["delete"]({hd:d.a,tl:0})})},b("Promise").resolve(void 0))})}function a(a){return g(a).then(function(a){})}f.dropAllInSecureThreads=g;f.call=a}),null);
__d("MAWBridgeGroupInfoUpdatedHandler.bs",["MAWThreadId.bs","Promise","ReQL.bs","ReQLTable","bs_caml_obj","bs_caml_option","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=c.threadName,f=e==null?void 0:b("bs_caml_option").some(e);return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"threads").asc,{hd:d,tl:0})).then(function(c){if(c!==void 0){c=b("bs_caml_obj").caml_obj_dup(c);return b("ReQLTable").table(a,"threads").put((c.d=f,c))}b("recoverableViolation")("Trying to update group thread name with non-existing group thread","messenger_e2ee_web");return b("Promise").resolve(void 0)})})}function a(a,b){return g(a,b).then(function(a){})}f.call=a}),null);
__d("MAWBridgeInitSyncCompleteHandler.bs",["CurrentLocale","LSDict","LSJson","LSLogHistory.bs","LSSyncChannel.bs","LSSyncStatus.bs","MAWInitSyncComplete.bs","Promise","ReQLTable","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function a(a){var c;b("LSLogHistory.bs").log("Init Sync Complete","debug");return window.Promise.all([b("ReQLTable").table(a,"sync_groups").add({a:b("MAWInitSyncComplete.bs").id,b:void 0,c:b("LSSyncStatus.bs").complete,d:b("LSJson").stringify(new(b("LSDict"))([["locale",b("CurrentLocale").get()]])),e:!0,f:[2328,1316134911],g:!1,h:(c=b("bs_caml_int64")).zero,i:c.zero,j:void 0,k:void 0,l:void 0,m:void 0,n:b("LSSyncChannel.bs").mqtt}),b("ReQLTable").table(a,"network_requests").add({a:"",b:b("MAWInitSyncComplete.bs").id,c:c.neg_one,d:void 0,e:c.zero,f:c.zero,g:c.zero,h:void 0})]).then(function(a){return b("Promise").resolve(void 0)})}f.call=a}),null);
__d("MAWBridgeMediaExpiredHandler.bs",["MAWThreadId.bs","ReQLTable"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d=String(c.mediaId);return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(e){return b("ReQLTable").table(a,"attachments")["delete"]({hd:e,tl:{hd:c.msgId,tl:{hd:d,tl:0}}})})}f.call=a}),null);
__d("MAWBridgeMsgExpiredHandler.bs",["MAWThreadId.bs","MAWTimeUtils.bs","ReQLTable"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.chatId).then(function(d){return b("ReQLTable").table(a,"messages")["delete"]({hd:d,tl:{hd:b("MAWTimeUtils.bs").toTimestamp(c.ts),tl:{hd:c.msgId,tl:0}}})})}f.call=a}),null);
__d("MAWEphemeralMessageExpirationStorage.bs",["MAWBridgeMsgExpiredHandler.bs","bs_belt_Array","clearTimeout","promiseDone","setTimeout"],(function(a,b,c,d,e,f){"use strict";var g=new Map();function h(a,c,d){b("bs_belt_Array").forEach(c,function(c){var d=c.ts,e=c.chatId;c=c.msgId;d={ts:d,chatId:e,msgId:c};b("promiseDone")(b("MAWBridgeMsgExpiredHandler.bs").call(a,d),void 0,void 0)});return g["delete"](d)}function i(a,c,d,e){return b("setTimeout")(function(b){h(a,c,d)},e)}function a(a,c,d,e){var f=g.get(d);c=f==null?[c]:(b("clearTimeout")(f.timeoutId),f.msgs.map(function(a){return a.msgId}).indexOf(c.msgId)===-1?(f.msgs.push(c),void 0):void 0,f.msgs);f=i(a,c,d,e);g.set(d,{expirationTs:d,msgs:c,timeoutId:f})}function c(a){var b=a.msgId;a=g.get(a.countdownTs);if(a==null)return;b=a.msgs.map(function(a){return a.msgId}).indexOf(b);if(b>-1){a.msgs.splice(b,1);return}}f.setMessageForExpiration=a;f.clearMessageFromExpiration=c}),null);
__d("MAWBridgeMsgClearCountdownHandler.bs",["MAWEphemeralMessageExpirationStorage.bs","Promise"],(function(a,b,c,d,e,f){"use strict";function a(a){b("MAWEphemeralMessageExpirationStorage.bs").clearMessageFromExpiration(a);return b("Promise").resolve(void 0)}f.call=a}),null);
__d("LSMessageUnsendabilityStatus.bs",["bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";a=b("bs_caml_int64").zero;c=b("bs_caml_int64").one;d=[0,2];e=[0,3];b=[0,4];var g=[0,5],h=[0,6],i=[0,7];f.canUnsend=a;f.denyLogMessage=c;f.denyTombstoneMessage=d;f.denyForNonSender=e;f.denyP2pPayment=b;f.denyStoryReaction=g;f.denyBlobAttachment=h;f.denyMessageNotFound=i}),null);
__d("MAWMsgReply.bs",["fbt","LSMessageReplySourceType.bs","LSMessageReplySourceTypeV2.bs","LSReplyMessageAttachmentType.bs","LSReplyMessageStatus.bs","MAWImagePreProcess","Promise","ReQL.bs","ReQLTable","bs_belt_Option","bs_caml_array","bs_caml_format","bs_caml_int64","bs_caml_option","bs_int64"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return!b("bs_belt_Option").isNone(a.replySourceId)}function c(a){a=a.replyToUserId;if(a!==void 0)return b("bs_caml_format").caml_int64_of_string(b("bs_caml_option").valFromOption(a))}function d(a){if(a.isForwarded)return b("LSMessageReplySourceTypeV2.bs").forward;else if(!b("bs_belt_Option").isNone(a.replySourceId))return b("LSMessageReplySourceTypeV2.bs").message;else return}function e(a){if(!b("bs_belt_Option").isNone(a.replySourceId))return b("LSMessageReplySourceType.bs").message}function h(a){if(!b("bs_belt_Option").isNone(a.replySourceId))return a.replySourceId}function i(a){if(!b("bs_belt_Option").isNone(a.replySourceId))return a.replyMessageText}function j(a){a=a.replyStatusType;if(a===void 0)return;switch(a){case"EphemeralScreenshotAction":case"EphemeralSettingAdmin":case"EphemeralSettingChangeFromCurrentDevice":case"EphemeralSyncResponse":return b("LSReplyMessageStatus.bs").unknown;case"ExpiredEphemeral":return b("LSReplyMessageStatus.bs").expired;case"DeleteForMe":case"Revoked":return b("LSReplyMessageStatus.bs").deleted;case"Ciphertext":case"Futureproof":case"Unavailable":return b("LSReplyMessageStatus.bs").temporaryUnavailable;case"Admin":case"Gif":case"Image":case"Ptt":case"Sticker":case"Text":case"Video":return b("LSReplyMessageStatus.bs").valid;default:return}}function k(a){if(b("bs_belt_Option").isNone(a.replySourceId))return!1;else return b("bs_belt_Option").isSome(a.replyMediaUrl)}function l(a){a=new File([b("bs_belt_Option").getExn(a.replyMediaUrl)],"replySticker",{type:b("bs_belt_Option").getExn(a.replyMediaUrlMimeType)});return b("MAWImagePreProcess").imageTranscode(a,"image/webp").then(function(a){return URL.createObjectURL(a)})}function m(a){var c=k(a),d=a.replyStatusType;if(!c)return b("Promise").resolve(void 0);return d==="Sticker"?l(a):b("Promise").resolve(b("bs_belt_Option").map(a.replyMediaUrl,function(a){return URL.createObjectURL(a)}))}function n(a){if(k(a))return a.replyMediaUrlMimeType}function o(a){if(k(a))return b("bs_belt_Option").map(a.replyMediaPreviewHeight,b("bs_caml_int64").of_int32)}function p(a){if(k(a))return b("bs_belt_Option").map(a.replyMediaPreviewWidth,b("bs_caml_int64").of_int32)}function q(a){var c=k(a);a=a.replyStatusType;if(!c)return;if(a===void 0)return;switch(a){case"Gif":return b("LSReplyMessageAttachmentType.bs").gif;case"Image":return b("LSReplyMessageAttachmentType.bs").photo;case"Ptt":return b("LSReplyMessageAttachmentType.bs").other;case"Sticker":return b("LSReplyMessageAttachmentType.bs").sticker;case"Video":return b("LSReplyMessageAttachmentType.bs").video;default:return}}function r(a){if(k(a))return b("bs_caml_int64").of_int32(a.rowId)}function s(a,c,d){if(b("bs_belt_Option").isNone(d.replySourceId))return b("Promise").resolve(void 0);var e=b("bs_belt_Option").getExn(d.replyToUserId)===d.sender;c=b("bs_caml_format").caml_int64_of_string(b("bs_belt_Option").getExn(d.replyToUserId));var f=b("bs_caml_format").caml_int64_of_string(d.sender);return b("Promise").all([b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"contacts").asc,{hd:c,tl:0})),b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"contacts").asc,{hd:f,tl:0}))]).then(function(a){var c=b("bs_caml_array").get(a,0);a=b("bs_caml_array").get(a,1);var f=function(a){return b("bs_belt_Option").eq(j(d),a,function(a,c){return b("bs_int64").compare(a,c)===0})};f=f(b("LSReplyMessageStatus.bs").deleted)||f(b("LSReplyMessageStatus.bs").temporaryUnavailable)||f(b("LSReplyMessageStatus.bs").expired);var h=d.isAuthorMe,i=d.replySenderIsMe;if(f){if(h)return g._(/*FBT_CALL*/"Respondiste a un mensaje eliminado"/*FBT_CALL*/).toString();if(a!==void 0)return g._(/*FBT_CALL*/"{name} respondi\u00f3 a un mensaje eliminado"/*FBT_CALL*/,[g._param("name",a.h)]).toString()}else if(h){if(i!==void 0){if(i)return g._(/*FBT_CALL*/"Respondiste a tu propio mensaje"/*FBT_CALL*/).toString();if(!e&&c!==void 0)return g._(/*FBT_CALL*/"Respondiste a {other_name}"/*FBT_CALL*/,[g._param("other_name",c.h)]).toString()}}else if(i!==void 0)if(i){if(!e&&a!==void 0)return g._(/*FBT_CALL*/"{other_name} te respondi\u00f3"/*FBT_CALL*/,[g._param("other_name",a.h)]).toString()}else if(e){if(a!==void 0)return g._(/*FBT_CALL*/"{other} respondi\u00f3 a su propio mensaje"/*FBT_CALL*/,[g._param("other",a.h)]).toString()}else if(c!==void 0&&a!==void 0)return g._(/*FBT_CALL*/"{other} respondi\u00f3 a {other_name}"/*FBT_CALL*/,[g._param("other",a.h),g._param("other_name",c.h)]).toString();if(c!==void 0)if(a!==void 0)return g._(/*FBT_CALL*/"Alguien respondi\u00f3 a un participante"/*FBT_CALL*/).toString();else return g._(/*FBT_CALL*/"Alguien respondi\u00f3 a {name}"/*FBT_CALL*/,[g._param("name",c.h)]).toString();else if(a!==void 0)return g._(/*FBT_CALL*/"{name} respondi\u00f3 a un participante"/*FBT_CALL*/,[g._param("name",a.h)]).toString();else return g._(/*FBT_CALL*/"Alguien respondi\u00f3 a un participante"/*FBT_CALL*/).toString()})}f.hasReply=a;f.getReplyUserId=c;f.getReplySourceTypeV2=d;f.getReplySourceType=e;f.getReplySourceId=h;f.getReplyMessageText=i;f.getReplyStatus=j;f.hasReplyMedia=k;f.makeStickerUnanimated=l;f.getReplyMediaUrl=m;f.getReplyMediaMimeType=n;f.getReplyMediaHeight=o;f.getReplyMediaWidth=p;f.getReplyAttachmentType=q;f.getReplyAttachmentId=r;f.getReplySnippet=s}),null);
__d("MAWBridgeMsgUpdatedHandler.bs",["LSMessageUnsendabilityStatus.bs","MAWAckLevel.bs","MAWMsg.bs","MAWMsgReply.bs","MAWThreadId.bs","MAWTimeUtils.bs","MWV2DualSendText.bs","Promise","ReQL.bs","ReQLTable","bs_belt_Option","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.chatId).then(function(d){return b("Promise").all([b("MAWMsgReply.bs").getReplySnippet(a,d,c),b("MAWMsgReply.bs").getReplyMediaUrl(c)]).then(function(a){return[a[0],d,a[1]]})}).then(function(d){var e=d[1],f=d[0],g=d[2],h=c.type_===b("MAWMsg.bs").unsent;return b("ReQL.bs").first(b("ReQL.bs").filter(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"messages").asc,{hd:e,tl:0}),function(a){return a.e===c.msgId})).then(function(d){if(d===void 0)return b("Promise").resolve(void 0);if(b("MWV2DualSendText.bs").isDualSend(c.content))return b("Promise").resolve(void 0);var e=b("MAWAckLevel.bs").levelToMessagingSendStatusV2(c.ack);d=b("bs_caml_obj").caml_obj_dup(d);return b("ReQLTable").table(a,"messages").put((d.Y=void 0,d.X=h?b("MAWTimeUtils.bs").toTimestamp(c.ts):void 0,d.Q=b("MAWMsg.bs").getDisplayedContentTypes(c.type_,c.isForwarded),d.N=h||!c.isAuthorMe?b("LSMessageUnsendabilityStatus.bs").denyForNonSender:void 0,d.I=void 0,d.H=b("MAWMsgReply.bs").getReplyAttachmentId(c),d.G=b("MAWMsgReply.bs").getReplyAttachmentType(c),d.C=b("MAWMsgReply.bs").getReplyMediaMimeType(c),d.B=b("MAWMsgReply.bs").getReplyMediaHeight(c),d.A=b("MAWMsgReply.bs").getReplyMediaWidth(c),d.z=g,d.y=void 0,d.x=b("MAWMsgReply.bs").getReplyUserId(c),d.w=b("MAWMsgReply.bs").getReplyMessageText(c),d.v=f,d.u=b("MAWMsgReply.bs").getReplyStatus(c),d.t=b("MAWMsgReply.bs").getReplySourceTypeV2(c),d.s=b("MAWMsgReply.bs").getReplySourceType(c),d.r=b("MAWMsgReply.bs").getReplySourceId(c),d.m=h,d.l=e,d.k=b("MAWAckLevel.bs").levelToMessagingSendStatus(c.ack),d.g=c.content,d.b=b("MAWTimeUtils.bs").toTimestamp(h?b("bs_belt_Option").getWithDefault(c.originalTs,c.ts):c.ts),d))})})}f.call=a}),null);
__d("MAWBridgeMsgsLoadedHandler.bs",["LS.bs","LSInsertNewMessageRange","MAWThreadId.bs","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=c.rangeExtensionType,f;if(typeof e==="number")f=b("bs_caml_int64").zero;else switch(e.TAG|0){case 0:case 1:f=b("bs_caml_int64").of_int32(e._0.minRowId);break;case 2:f=b("bs_caml_int64").zero;break}e=c.rangeExtensionType;e=typeof e==="number"?[2328,1316134911]:e.TAG===2?b("bs_caml_int64").of_int32(e._0.maxRowId):[2328,1316134911];var g=c.rangeExtensionType,h;if(typeof g==="number")h="";else switch(g.TAG|0){case 0:case 1:h=g._0.minMsgId;break;case 2:h="";break}g=c.rangeExtensionType;var i;if(typeof g==="number")i="";else switch(g.TAG|0){case 0:i=g._0.maxMsgId;break;case 1:i="";break;case 2:i=g._0.maxMsgId;break}g=c.rangeExtensionType;var j;if(typeof g==="number")j=b("bs_caml_int64").zero;else switch(g.TAG|0){case 0:case 1:j=b("bs_caml_int64").of_int32(g._0.minRowId);break;case 2:j=b("bs_caml_int64").zero;break}g=c.rangeExtensionType;g=typeof g==="number"?[2328,1316134911]:g.TAG===2?b("bs_caml_int64").of_int32(g._0.maxRowId):[2328,1316134911];var k=c.rangeExtensionType,l;if(typeof k==="number")l=!1;else switch(k.TAG|0){case 0:l=k._0.hasMoreBefore;break;case 1:l=k._0.hasMoreBefore;break;case 2:l=!1;break}k=c.rangeExtensionType;k=typeof k==="number"||k.TAG!==2?!1:k._0.hasMoreAfter;return b("LSInsertNewMessageRange")(d,f,e,h,i,j,g,l,k,void 0,b("LS.bs").make(a))})}f.call=a}),null);
__d("MAWBridgeMsgsStartCountdownHandler.bs",["MAWEphemeralMessageExpirationStorage.bs","MAWThreadId.bs","MAWTimeUtils.bs","Promise","ReQL.bs","ReQLTable","bs_caml_int64","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("Promise").all(c.msgs.map(function(c){b("MAWEphemeralMessageExpirationStorage.bs").setMessageForExpiration(a,c,c.countdownTs,c.millisecondsUntilCountdownTs);b("bs_caml_int64").of_int32(c.millisecondsUntilCountdownTs);return b("MAWThreadId.bs").toThreadKey(a,c.chatId).then(function(d){return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"messages").asc,{hd:d,tl:{hd:b("MAWTimeUtils.bs").toTimestamp(c.ts),tl:{hd:c.msgId,tl:0}}})).then(function(d){if(d===void 0)return b("Promise").resolve(void 0);d=b("bs_caml_obj").caml_obj_dup(d);return b("ReQLTable").table(a,"messages").put((d.bd=b("bs_caml_int64").of_float(c.countdownTs),d))})})})).then(function(a){})}f.call=a}),null);
__d("MAWBridgeNewMediaHandler.bs",["MAWDbMsg","MAWMedia.bs","MAWThreadId.bs","Promise","ReQLTable","ReQLTable.bs","bs_belt_Option","bs_caml_int64","bs_caml_obj","bs_caml_option"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=String(c.mediaId);return b("Promise").all(c.msgIds.map(function(f){var g=b("bs_caml_int64").of_int32(b("MAWDbMsg").getInChatMsgIdFromMsgId(f));return b("ReQLTable.bs").update(b("ReQLTable").table(a,"attachments"),{hd:d,tl:{hd:f,tl:{hd:e,tl:0}}},function(a){if(a===void 0){var h,i,j;return{a:d,b:g,c:f,d:e,e:e,f:b("MAWMedia.bs").mediaTypeToMessageAttachmentType(c.mediaType),g:void 0,h:void 0,i:(h=b("bs_belt_Option")).map(c.filesize,(i=b("bs_caml_int64")).of_int32),j:c.hasMedia,k:!1,l:!1,m:void 0,n:void 0,o:void 0,p:void 0,q:void 0,r:void 0,s:void 0,t:void 0,u:void 0,v:void 0,w:void 0,x:void 0,y:void 0,z:void 0,A:void 0,B:void 0,C:void 0,D:void 0,E:void 0,F:void 0,G:void 0,H:void 0,I:void 0,J:void 0,K:h.map((j=b("bs_caml_option")).nullable_to_opt(c.previewWidth),i.of_int32),L:h.map(j.nullable_to_opt(c.previewHeight),i.of_int32),M:void 0,N:void 0,O:void 0,P:void 0,Q:void 0,R:void 0,S:void 0,T:void 0,U:void 0,V:void 0,W:void 0,X:void 0,Y:void 0,Z:void 0,ba:void 0,bb:void 0,bc:void 0,bd:h.map(j.nullable_to_opt(c.duration),i.of_int32),be:i.zero,bf:void 0,bg:void 0,bh:void 0,bi:void 0,bj:void 0,bk:void 0,bl:void 0,bm:void 0,bn:void 0,bo:void 0,bp:void 0,bq:void 0,br:void 0,bs:void 0,bt:void 0,bu:void 0,bv:void 0,bw:void 0,bx:void 0,by:void 0,bz:void 0,bA:void 0,bB:void 0,bC:void 0,bD:void 0,bE:void 0,bF:void 0,bG:void 0,bH:void 0,bI:void 0,bJ:void 0,bK:void 0,bL:void 0,bM:void 0,bN:void 0,bO:void 0,bP:void 0,bQ:void 0,bR:void 0,bS:void 0,bT:void 0,bU:i.zero,bV:void 0,bW:void 0,bX:void 0,bY:void 0,bZ:h.map(j.nullable_to_opt(c.previewWidthLarge),i.of_int32),ca:h.map(j.nullable_to_opt(c.previewHeightLarge),i.of_int32),cb:void 0,cc:void 0,cd:void 0,ce:void 0,cf:void 0,cg:void 0,ch:void 0,ci:void 0,cj:void 0,ck:void 0,cl:void 0,cm:void 0,cn:void 0,co:void 0,cp:void 0,cq:void 0,cr:void 0,cs:void 0}}h=b("bs_caml_obj").caml_obj_dup(a);h.j=c.hasMedia;return h})}))})}function a(a,b){return g(a,b).then(function(a){})}f.call=a}),null);
__d("MAWBridgeNewMediaRangeHandler.bs",["LS.bs","LSThreadMediaGalleryGroup.bs","LSUpsertAttachmentRange","MAWThreadId.bs","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=b("bs_caml_int64").of_int32(c.minMsgRowId),f=c.hasMoreBefore;return b("LSUpsertAttachmentRange")(d,b("LSThreadMediaGalleryGroup.bs").photosAndVideos,e,f,b("LS.bs").make(a))})}function a(a,b){return g(a,b).then(function(a){})}f.call=a}),null);
__d("MAWBridgeNewMsgHandler.bs",["LSAuthorityLevel.bs","LSMessageUnsendabilityStatus.bs","LSMessageViewFlag.bs","LSQuickReplyType.bs","MAWAckLevel.bs","MAWAdminMsg.bs","MAWAdminMsgCTA.bs","MAWLocalizationType","MAWMsg.bs","MAWMsgReply.bs","MAWThreadId.bs","MAWTimeUtils.bs","MWV2DualSendText.bs","Promise","ReQL.bs","ReQLTable","bs_belt_Option","bs_caml_format","bs_caml_int64","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";function g(a,c,d,e,f,g){e=e!==void 0?[e.ctaId,e.title,e.ctaType]:[void 0,void 0,void 0];if(d.isAdminMessage){var h=d.adminContent,i=d.adminType;h=h!==void 0&&i!==void 0?b("MAWAdminMsg.bs").buildLocalizedString(h,i):void 0}else h=d.content;i=d.ephemeralDurationInSec;return b("ReQLTable").table(a,"messages").add({a:c,b:b("MAWTimeUtils.bs").toTimestamp(d.type_===b("MAWMsg.bs").unsent?b("bs_belt_Option").getWithDefault(d.originalTs,d.ts):d.ts),c:b("bs_caml_int64").of_int32(d.rowId),d:void 0,e:d.msgId,f:d.msgId,g:h,h:b("bs_caml_format").caml_int64_of_string(d.sender),i:void 0,j:d.isAdminMessage,k:b("MAWAckLevel.bs").levelToMessagingSendStatus(d.ack),l:b("MAWAckLevel.bs").levelToMessagingSendStatusV2(d.ack),m:d.type_===b("MAWMsg.bs").unsent,n:void 0,o:void 0,p:void 0,q:void 0,r:b("MAWMsgReply.bs").getReplySourceId(d),s:b("MAWMsgReply.bs").getReplySourceType(d),t:b("MAWMsgReply.bs").getReplySourceTypeV2(d),u:b("MAWMsgReply.bs").getReplyStatus(d),v:f,w:b("MAWMsgReply.bs").getReplyMessageText(d),x:b("MAWMsgReply.bs").getReplyUserId(d),y:void 0,z:g,A:b("MAWMsgReply.bs").getReplyMediaWidth(d),B:b("MAWMsgReply.bs").getReplyMediaHeight(d),C:b("MAWMsgReply.bs").getReplyMediaMimeType(d),D:void 0,E:void 0,F:void 0,G:b("MAWMsgReply.bs").getReplyAttachmentType(d),H:b("MAWMsgReply.bs").getReplyAttachmentId(d),I:void 0,J:!1,K:e[0],L:e[1],M:e[2],N:d.type_===b("MAWMsg.bs").unsent||!d.isAuthorMe?b("LSMessageUnsendabilityStatus.bs").denyForNonSender:void 0,O:!1,P:b("LSMessageViewFlag.bs").uncalculated,Q:b("MAWMsg.bs").getDisplayedContentTypes(d.type_,d.isForwarded),R:void 0,S:void 0,T:b("LSQuickReplyType.bs").none,U:void 0,V:b("LSAuthorityLevel.bs").authoritative,W:void 0,X:b("MAWTimeUtils.bs").toTimestamp(d.ts),Y:void 0,Z:void 0,ba:i!==void 0?b("bs_caml_int64").of_int32(i):void 0,bb:void 0,bc:void 0,bd:void 0})}function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.chatId).then(function(d){var e=c.adminType;if(e!==void 0&&b("MAWLocalizationType").isEphemeralSettingSetAdminMsg(e))return b("MAWAdminMsgCTA.bs").createAdminMsgCta(a,d,c).then(function(a){return{result:a,threadKey:d}});else return b("Promise").resolve({result:void 0,threadKey:d})}).then(function(d){return b("Promise").all([b("MAWMsgReply.bs").getReplySnippet(a,d.threadKey,c),b("MAWMsgReply.bs").getReplyMediaUrl(c)]).then(function(a){return[d,a[0],a[1]]})}).then(function(d){var e=d[2],f=d[1];d=d[0];if(b("MWV2DualSendText.bs").isDualSend(c.content))return b("Promise").resolve(void 0);var h=c.offlineMsg;if(h!==void 0){var i=d.threadKey,j=d.result,k=j!==void 0?[j.ctaId,j.title,j.ctaType]:[void 0,void 0,void 0],l=k[2],m=k[1],n=k[0];return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"messages").asc,{hd:i,tl:{hd:b("bs_caml_int64").of_float(h.ts),tl:{hd:h.msgId,tl:0}}})).then(function(d){if(d===void 0)return g(a,i,c,j,f,e);d=b("bs_caml_obj").caml_obj_dup(d);var h=c.ephemeralDurationInSec;d.ba=h!==void 0?b("bs_caml_int64").of_int32(h):void 0;return b("ReQLTable").table(a,"messages").put((d.Y=void 0,d.V=b("LSAuthorityLevel.bs").authoritative,d.Q=b("MAWMsg.bs").getDisplayedContentTypes(c.type_,c.isForwarded),d.M=l,d.L=m,d.K=n,d.H=b("MAWMsgReply.bs").getReplyAttachmentId(c),d.G=b("MAWMsgReply.bs").getReplyAttachmentType(c),d.C=b("MAWMsgReply.bs").getReplyMediaMimeType(c),d.B=b("MAWMsgReply.bs").getReplyMediaHeight(c),d.A=b("MAWMsgReply.bs").getReplyMediaWidth(c),d.z=e,d.y=void 0,d.x=b("MAWMsgReply.bs").getReplyUserId(c),d.w=b("MAWMsgReply.bs").getReplyMessageText(c),d.v=f,d.u=b("MAWMsgReply.bs").getReplyStatus(c),d.t=b("MAWMsgReply.bs").getReplySourceTypeV2(c),d.s=b("MAWMsgReply.bs").getReplySourceType(c),d.r=b("MAWMsgReply.bs").getReplySourceId(c),d.m=c.type_===b("MAWMsg.bs").unsent,d.l=b("MAWAckLevel.bs").levelToMessagingSendStatusV2(c.ack),d.k=b("MAWAckLevel.bs").levelToMessagingSendStatus(c.ack),d.e=c.msgId,d.c=b("bs_caml_int64").of_int32(c.rowId),d.b=b("MAWTimeUtils.bs").toTimestamp(c.ts),d))})}else return g(a,d.threadKey,c,d.result,f,e)}).then(function(a){})}f.call=a}),null);
__d("MAWBridgeParticipantRemovedHandler.bs",["MAWThreadId.bs","ReQLTable","bs_caml_format"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=b("bs_caml_format").caml_int64_of_string(c.fbid);return b("ReQLTable").table(a,"participants")["delete"]({hd:d,tl:{hd:e,tl:0}}).then(function(a){})})}f.call=a}),null);
__d("MAWUpdateLSThreadCapabilities.bs",["LSBitOffset.bs","LSContactBitOffset.bs","LSContactBlockedByViewerStatus.bs","LSContactCapabilityBitOffset.bs","LSMessagingThreadTypeUtil.bs","LSThreadBitOffset.bs","LSThreadCapabilityBitOffset.bs","MAWBlockUtils.bs","MAWCurrentUser","MAWMessengerRestrictUtils.bs","Promise","ReQL.bs","ReQLTable","SortedAsyncIterable.bs","bs_belt_Option","bs_caml","bs_caml_format","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";e=b("MAWCurrentUser").getID();var g=b("bs_caml_format").caml_int64_of_string(e);function a(a,c){return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"threads").asc,{hd:c,tl:0})).then(function(c){if(c===void 0)return b("Promise").resolve(void 0);var d=b("LSBitOffset.bs").set(b("LSThreadCapabilityBitOffset.bs").addMember,c.P);c=b("bs_caml_obj").caml_obj_dup(c);return b("ReQLTable").table(a,"threads").put((c.P=d,c))}).then(function(a){})}function c(a,c){return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"threads").asc,{hd:c,tl:0})).then(function(c){if(c===void 0)return b("Promise").resolve(void 0);var d=b("LSBitOffset.bs").clear(b("LSThreadCapabilityBitOffset.bs").addMember,c.P);c=b("bs_caml_obj").caml_obj_dup(c);return b("ReQLTable").table(a,"threads").put((c.P=d,c))}).then(function(a){})}function d(a,c){return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"threads").asc,{hd:c,tl:0})).then(function(d){if(d===void 0)return b("Promise").resolve([void 0,void 0]);var e=b("ReQL.bs").first(b("LSMessagingThreadTypeUtil.bs").isOneToOne(d.c)?b("ReQL.bs").map(b("ReQL.bs").filter(b("ReQL.bs").mergeJoin(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"participants").asc,{hd:c,tl:0}),b("ReQLTable").table(a,"contacts").asc),function(a){return b("bs_caml").i64_neq(a[1].a,g)}),function(a){return a[1]}):b("SortedAsyncIterable.bs").empty(void 0));return b("Promise").all([b("Promise").resolve(d),e])}).then(function(c){var d=c[0];if(d===void 0)return b("Promise").resolve(void 0);c=c[1];if(c===void 0)return b("Promise").resolve(void 0);var e=b("bs_caml").i64_eq(c.n,b("LSContactBlockedByViewerStatus.bs").messageBlocked),f=b("bs_caml").i64_eq(c.n,b("LSContactBlockedByViewerStatus.bs").fullyBlocked);c=b("bs_belt_Option").getWithDefault(b("LSContactBitOffset.bs").has(b("LSContactCapabilityBitOffset.bs").restrictPlaced,c),!1);f=f?b("LSThreadBitOffset.bs").clear(b("MAWBlockUtils.bs").clearedFbBlockCapabilities,d.P,d.bb):e?b("LSThreadBitOffset.bs").clear(b("MAWBlockUtils.bs").clearedMnBlockCapabilities,d.P,d.bb):c?b("LSThreadBitOffset.bs").clear(b("MAWMessengerRestrictUtils.bs").clearedMnRestrictCapabilities,d.P,d.bb):[d.P,d.bb];e=b("bs_caml_obj").caml_obj_dup(d);return b("ReQLTable").table(a,"threads").put((e.bb=f[1],e.P=f[0],e)).then(function(a){})})}f.currentUserId=e;f.currentUserIdAsInt64=g;f.enableAddMembersTxn=a;f.disableAddMembersTxn=c;f.disableBlockerCapabilitiesTxn=d}),null);
__d("MAWBridgeParticipantUpdatedHandler.bs",["fbt","LS.bs","LSAuthorityLevel.bs","LSContactBlockedByViewerStatus.bs","LSContactGender.bs","LSContactIdType.bs","LSContactType.bs","LSContactViewerRelationship.bs","LSContactWorkForeignEntityType.bs","LSGroupParticipantJoinState.bs","LSVerifyContactRowExists","MAWCurrentUser","MAWThreadId.bs","MAWTimeUtils.bs","MAWUpdateLSThreadCapabilities.bs","ReQLTable","ReQLTable.bs","bs_caml","bs_caml_format","bs_caml_int64","bs_caml_obj"],(function(a,b,c,d,e,f,g){"use strict";var h=b("MAWCurrentUser").getID(),i=b("bs_caml_format").caml_int64_of_string(h);function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=b("bs_caml_format").caml_int64_of_string(c.fbid),f=b("MAWTimeUtils.bs").toTimestamp(c.readWatermarkTs),j=b("MAWTimeUtils.bs").toTimestamp(c.deliveredWatermarkTs),k=b("MAWTimeUtils.bs").toTimestamp(c.lastReadActionTs),l=c.isSuperAdmin?g._(/*FBT_CALL*/"Creador del grupo"/*FBT_CALL*/).toString():void 0,m={contents:window.Promise.resolve(void 0)},n=function(f){return b("MAWUpdateLSThreadCapabilities.bs").disableBlockerCapabilitiesTxn(a,d).then(function(f){f=b("bs_caml").i64_eq(i,e);var g=c.isAdmin;if(f)if(g)return b("MAWUpdateLSThreadCapabilities.bs").enableAddMembersTxn(a,d);else return b("MAWUpdateLSThreadCapabilities.bs").disableAddMembersTxn(a,d);else return window.Promise.resolve(void 0)})},o={contents:window.Promise.resolve(void 0)},p=function(d){return b("LSVerifyContactRowExists")(e,b("LSContactIdType.bs").fbid,void 0,void 0,b("LSContactType.bs").user,void 0,void 0,void 0,void 0,!1,!1,b("LSContactBlockedByViewerStatus.bs").unblocked,void 0,b("bs_caml_obj").caml_equal(h,c.fbid),b("LSAuthorityLevel.bs").optimistic,void 0,void 0,b("LSContactWorkForeignEntityType.bs").unknown,b("LSContactGender.bs").unknown,b("LSContactViewerRelationship.bs").unknown,void 0,b("LS.bs").make(a))},q=b("ReQLTable.bs").update(b("ReQLTable").table(a,"participants"),{hd:d,tl:{hd:e,tl:0}},function(a){if(a!==void 0){m.contents=n(void 0);return{a:d,b:e,c:f,d:j,e:a.e,f:c.isAdmin,g:l,h:a.h,i:a.i,j:a.j,k:k,l:a.l,m:!1,n:a.n}}else{m.contents=n(void 0);o.contents=p(void 0);return{a:d,b:e,c:f,d:j,e:void 0,f:c.isAdmin,g:l,h:void 0,i:void 0,j:b("bs_caml_int64").zero,k:b("bs_caml_int64").zero,l:c.isSuperAdmin,m:!1,n:b("LSGroupParticipantJoinState.bs").member}}});return q.then(function(a){return window.Promise.all([m.contents,o.contents])}).then(function(a){})})}f.currentUserId=h;f.currentUserIdAsInt64=i;f.call=a}),null);
__d("MAWBridgeReactionUpsertHandler.bs",["LSAuthorityLevel.bs","MAWThreadId.bs","MAWTimeUtils.bs","ReQLTable","bs_caml_format"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){return b("ReQLTable").table(a,"reactions").upsert({hd:d,tl:{hd:c.messageId,tl:{hd:b("bs_caml_format").caml_int64_of_string(c.actorId),tl:0}}},{a:d,b:b("MAWTimeUtils.bs").toTimestamp(c.ts),c:c.messageId,d:b("bs_caml_format").caml_int64_of_string(c.actorId),e:c.reaction,f:b("LSAuthorityLevel.bs").authoritative})})}function a(a,b){return g(a,b).then(function(a){})}f.call=a}),null);
__d("MAWBridgeReceivedChatStateHandler.bs",["MAWThreadId.bs","ReQLTable","ServerTime","WAChatState","bs_caml_format","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=b("bs_caml_format").caml_int64_of_string(c.senderId),f=b("bs_caml_int64").of_float(3e3+b("ServerTime").getMillis());if(c.state===b("WAChatState").TYPING)return b("ReQLTable").table(a,"typing_indicator").upsert({hd:d,tl:{hd:e,tl:0}},{a:d,b:e,c:f}).then(function(a){});else if(c.state===b("WAChatState").IDLE)return b("ReQLTable").table(a,"typing_indicator")["delete"]({hd:d,tl:{hd:e,tl:0}}).then(function(a){});else return window.Promise.resolve(void 0)})}f.call=a}),null);
__d("MAWBridgeReceivedReceiptHandler.bs",["MAWThreadId.bs","MAWTimeUtils.bs","Promise","ReQL.bs","ReQLTable","bs_caml_format"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=b("bs_caml_format").caml_int64_of_string(c.fbid),f=b("MAWTimeUtils.bs").toTimestamp(c.lastReadWatermarkTs),g=b("MAWTimeUtils.bs").toTimestamp(c.deliveredWatermarkTs),h=b("MAWTimeUtils.bs").toTimestamp(c.lastReadActionTs);return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"participants").asc,{hd:d,tl:{hd:e,tl:0}})).then(function(c){if(c!==void 0)return b("ReQLTable").table(a,"participants").put({a:c.a,b:c.b,c:f,d:g,e:c.e,f:c.f,g:c.g,h:c.h,i:c.i,j:c.j,k:h,l:c.l,m:c.m,n:c.n});else return b("Promise").resolve(void 0)}).then(function(a){})})}f.call=a}),null);
__d("ArmadilloDataTraceCheckPoint.bs",[],(function(a,b,c,d,e,f){"use strict";a=[0,63];b=[0,98];c=[0,504];d=[0,1e3];e=[0,1001];var g=[0,1204],h=[0,1210],i=[0,1225];f.traceGroupMessage=a;f.traceCreated=b;f.richMediaMediaSendAttachmentType=c;f.traceTextMessage=d;f.traceMediaMessage=e;f.advancedCryptoMEMSendTaskComplete=g;f.deliveryReceiptReceived=h;f.advancedCryptoDualSend=i}),null);
__d("LSDataTraceTag.bs",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=4;var g=5,h=6,i=7;f.none=a;f.sticker=b;f.image=c;f.animatedImage=d;f.video=e;f.audio=g;f.file=h;f.xma=i}),null);
__d("MAWBridgeStartTraceHandler.bs",["ArmadilloDataTraceCheckPoint.bs","ArmadilloDataTraceType.bs","LS.bs","LSAppendDataTraceAddon","LSDataTraceTag.bs","LSRequestId.bs","MAWMsg.bs","MAWTimeUtils.bs","Promise","ReQLTable","bs_caml","bs_caml_int64","gkx","killswitch","promiseDone"],(function(a,b,c,d,e,f){"use strict";function a(a,c){if(!b("killswitch")("MESSENGER_WEB_DATA_TRACE_ID")&&b("gkx")("1951030")&&c.ack===7){var d=b("LSRequestId.bs").generate(void 0);return b("ReQLTable").table(a,"data_trace_meta").add({a:d,b:b("MAWTimeUtils.bs").toTimestamp(c.ts),c:b("bs_caml_int64").zero,d:b("ArmadilloDataTraceType.bs").armadilloMessageSend,e:!1,f:void 0,g:void 0,h:c.externalId,i:void 0}).then(function(c){return b("LSAppendDataTraceAddon")(d,b("ArmadilloDataTraceCheckPoint.bs").traceCreated,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a))}).then(function(e){e=c.isDS;var f=c.openMessageOtid;if(e&&f!==void 0)return b("LSAppendDataTraceAddon")(d,b("ArmadilloDataTraceCheckPoint.bs").advancedCryptoDualSend,b("bs_caml_int64").neg_one,void 0,f,b("LS.bs").make(a));else return b("Promise").resolve(void 0)}).then(function(e){e=c.type_;e=e===b("MAWMsg.bs").text?b("ArmadilloDataTraceCheckPoint.bs").traceTextMessage:e===b("MAWMsg.bs").ptt||e===b("MAWMsg.bs").image||e===b("MAWMsg.bs").video||e===b("MAWMsg.bs").gif?b("ArmadilloDataTraceCheckPoint.bs").traceMediaMessage:void 0;if(e===void 0)return window.Promise.resolve(e);var f=b("LSAppendDataTraceAddon")(d,e,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a));b("promiseDone")(f,void 0,void 0);return b("Promise").resolve(e)}).then(function(e){if(e===void 0)return window.Promise.resolve(void 0);if(!b("bs_caml").i64_eq(e,b("ArmadilloDataTraceCheckPoint.bs").traceMediaMessage))return window.Promise.resolve(void 0);e=c.type_;e=e===b("MAWMsg.bs").image?b("LSDataTraceTag.bs").image:e===b("MAWMsg.bs").ptt?b("LSDataTraceTag.bs").audio:e===b("MAWMsg.bs").video?b("LSDataTraceTag.bs").video:e===b("MAWMsg.bs").gif?b("LSDataTraceTag.bs").animatedImage:b("LSDataTraceTag.bs").none;return b("LSAppendDataTraceAddon")(d,b("ArmadilloDataTraceCheckPoint.bs").richMediaMediaSendAttachmentType,b("bs_caml_int64").neg_one,void 0,String(e),b("LS.bs").make(a))}).then(function(e){e=c.threadType;if(e)return b("LSAppendDataTraceAddon")(d,b("ArmadilloDataTraceCheckPoint.bs").traceGroupMessage,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a));else return window.Promise.resolve(void 0)})}else return window.Promise.resolve(void 0)}f.call=a}),null);
__d("MAWBridgeSyncContacts.bs",["CurrentUser","LS.bs","LSAuthorityLevel.bs","LSContactBlockedByViewerStatus.bs","LSContactGender.bs","LSContactIdType.bs","LSContactType.bs","LSContactViewerRelationship.bs","LSContactWorkForeignEntityType.bs","LSVerifyContactRowExists","bs_caml_format","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";var g=b("CurrentUser").getID();function a(a,c){var d=[];c.forEach(function(c){var e=b("bs_caml_format").caml_int64_of_string(c);e=b("LSVerifyContactRowExists")(e,b("LSContactIdType.bs").fbid,void 0,void 0,b("LSContactType.bs").user,void 0,void 0,void 0,void 0,!1,!1,b("LSContactBlockedByViewerStatus.bs").unblocked,void 0,b("bs_caml_obj").caml_equal(g,c),b("LSAuthorityLevel.bs").optimistic,void 0,void 0,b("LSContactWorkForeignEntityType.bs").unknown,b("LSContactGender.bs").unknown,b("LSContactViewerRelationship.bs").unknown,void 0,b("LS.bs").make(a));d.push(e)});return window.Promise.all(d).then(function(a){return window.Promise.resolve(void 0)})}f.currentUserFbid=g;f.call=a}),null);
__d("MAWBridgeThreadBumpedHandler.bs",["MAWAdminMsg.bs","MAWBumpThread.bs","MAWThreadId.bs","MAWTimeUtils.bs","MWV2DualSendText.bs","Promise","bs_belt_Option","bs_caml_format","bs_caml_option"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=b("MAWAdminMsg.bs").buildLocalizedString(c.snippetParams,c.snippetType),f=b("MWV2DualSendText.bs").isDualSend(e);if(f)return b("Promise").resolve(void 0);else return b("MAWBumpThread.bs").threadMutation(a,d,b("MAWTimeUtils.bs").toTimestamp(c.lastActivityTs),b("MAWTimeUtils.bs").toTimestamp(c.lastReadTs),e,b("bs_belt_Option").mapWithDefault(b("bs_caml_option").nullable_to_opt(c.snippetSenderContactId),void 0,function(a){return b("bs_caml_format").caml_int64_of_string(a)}))}).then(function(a){})}f.call=a}),null);
__d("MAWBridgeThreadHiddenHandler.bs",["MAWThreadId.bs","ReQLTable"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWThreadId.bs").toThreadKey(a,c).then(function(c){return b("ReQLTable").table(a,"threads")["delete"]({hd:c,tl:0}).then(function(a){})})}f.call=a}),null);
__d("MAWBridgeThreadTimestampsHandler.bs",["CurrentUser","MAWThreadId.bs","MAWTimeUtils.bs","Promise","ReQL.bs","ReQLTable","bs_caml_format","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){var e=b("bs_caml_format").caml_int64_of_string(b("CurrentUser").getID());return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"participants").asc,{hd:d,tl:{hd:e,tl:0}})).then(function(d){if(d!==void 0)return b("ReQLTable").table(a,"participants").put({a:d.a,b:d.b,c:b("MAWTimeUtils.bs").toTimestamp(c.lastReadWatermarkTs),d:d.d,e:d.e,f:d.f,g:d.g,h:d.h,i:d.i,j:d.j,k:b("MAWTimeUtils.bs").toTimestamp(c.lastActivityTimestampMs),l:d.l,m:d.m,n:d.n});else return b("Promise").resolve(void 0)})})}function h(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"threads").asc,{hd:d,tl:0})).then(function(d){if(d===void 0)return b("Promise").resolve(void 0);d=b("bs_caml_obj").caml_obj_dup(d);return b("ReQLTable").table(a,"threads").put((d.j=b("MAWTimeUtils.bs").toTimestamp(c.lastReadWatermarkTs),d))})})}function a(a,c){return window.Promise.all([h(a,c),g(a,c)]).then(function(a){return b("Promise").resolve(void 0)})}f.call=a}),null);
__d("MAWBridgeThreadUpdatedHandler.bs",["MAWAdminMsg.bs","MAWFolder.bs","MAWGating.bs","MAWThreadId.bs","MWV2DualSendText.bs","Promise","ReQL.bs","ReQLTable","bs_caml_format","bs_caml_int64","bs_caml_obj"],(function(a,b,c,d,e,f){"use strict";function g(a,c){return b("MAWThreadId.bs").toThreadKey(a,c.threadId).then(function(d){return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"threads").asc,{hd:d,tl:0})).then(function(d){if(d===void 0)return b("Promise").resolve(void 0);var e=c.snippetParams,f=c.snippetType;e=!(e==null)&&!(f==null)?b("MAWAdminMsg.bs").buildLocalizedString(e,f):d.m;f=b("MWV2DualSendText.bs").isDualSend(e);var g=c.snippetSenderContactId;g=g==null?d.o:b("bs_caml_format").caml_int64_of_string(g);var h=c.muteExpireTimeMs;h=!(h==null)&&!b("MAWGating.bs").isOccamadillo?b("bs_caml_int64").of_float(h):d.l;var i=c.folder;i=i==null?d.e:b("MAWFolder.bs").messagingFolderTag(c.folder);var j=c.folder;j=j==null?d.A:b("MAWFolder.bs").systemFolder(c.folder);var k=c.cannotReplyReason;k=k==null?i==="inbox"?void 0:d.v:k;var l=b("bs_caml_obj").caml_obj_dup(d);return b("ReQLTable").table(a,"threads").put((l.A=j,l.v=k,l.o=g,l.m=f?d.m:e,l.l=h,l.e=i,l))})})}function a(a,b){return g(a,b).then(function(a){})}f.call=a}),null);
__d("MAWBridgeThreadsLoadedHandler.bs",["MAWFolder.bs","MAWThreadId.bs","MAWTimeUtils.bs","Promise","ReQL.bs","ReQLTable","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d;switch(c.TAG|0){case 0:d=b("MAWFolder.bs").clientSystemFolder(c._0.folderId);break;case 1:d=b("MAWFolder.bs").clientSystemFolder(c._0.folderId);break;case 2:d=b("MAWFolder.bs").clientSystemFolder(c._0.folderId);break}return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQLTable").table(a,"threads_ranges_v2__generated").asc,{hd:d,tl:0})).then(function(e){if(e!==void 0)return b("ReQLTable").table(a,"threads_ranges_v2__generated")["delete"]({hd:e.a,tl:{hd:e.b,tl:{hd:e.c,tl:0}}}).then(function(f){switch(c.TAG|0){case 0:case 1:break;case 2:var d=c._0;return b("MAWThreadId.bs").toThreadKey(a,d.minThreadId).then(function(c){return b("ReQLTable").table(a,"threads_ranges_v2__generated").put({a:e.a,b:c,c:b("MAWTimeUtils.bs").toTimestamp(d.minLastActivityTs),d:e.d,e:e.e,f:!1,g:e.g,h:d.hasMore,i:e.i})})}return b("ReQLTable").table(a,"threads_ranges_v2__generated").put({a:e.a,b:e.b,c:e.c,d:e.d,e:e.e,f:!1,g:e.g,h:e.h,i:e.i})});switch(c.TAG|0){case 0:return b("ReQLTable").table(a,"threads_ranges_v2__generated").put({a:d,b:b("bs_caml_int64").zero,c:[2328,1316134911],d:b("bs_caml_int64").zero,e:[2328,1316134911],f:!1,g:!1,h:!1,i:!1});case 1:var f=c._0;return b("Promise").all([b("MAWThreadId.bs").toThreadKey(a,f.minThreadId),b("MAWThreadId.bs").toThreadKey(a,f.maxThreadId)]).then(function(c){return b("ReQLTable").table(a,"threads_ranges_v2__generated").add({a:d,b:c[0],c:b("MAWTimeUtils.bs").toTimestamp(f.minLastActivityTs),d:c[1],e:b("MAWTimeUtils.bs").toTimestamp(f.maxLastActivityTs),f:!1,g:!1,h:f.hasMore,i:!1})});case 2:return b("Promise").resolve(void 0)}})}f.call=a}),null);
__d("MAWBridgeUpdateTraceHandler.bs",["ArmadilloDataTraceCheckPoint.bs","LS.bs","LSAppendDataTraceAddon","LSFlushDataTrace.bs","MAWGating.bs","Promise","ReQL.bs","ReQLTable","bs_caml_int64","gkx","killswitch"],(function(a,b,c,d,e,f){"use strict";function g(a,c,d){return b("ReQL.bs").toArray(b("ReQL.bs").filter(b("ReQLTable").table(a,"data_trace_meta").asc,function(a){var b=a.h;if(b!==void 0&&c.externalIds.includes(b))return a.e===!1;else return!1})).then(function(c){return b("Promise").all(c.map(function(c){return b("LSAppendDataTraceAddon")(c.a,d,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a)).then(function(a){return window.Promise.resolve(c.a)})}))})}function h(a,c){return b("Promise").all(c.map(function(c){return b("LSFlushDataTrace.bs").updateAndFlushTrace(a,c)})).then(function(a){return window.Promise.resolve(void 0)})}function a(a,c){if(b("killswitch")("MESSENGER_WEB_DATA_TRACE_ID"))return window.Promise.resolve(void 0);if(!b("gkx")("1951030"))return window.Promise.resolve(void 0);var d=c.event;if(d==="ReceivedReceipt")return g(a,c,b("ArmadilloDataTraceCheckPoint.bs").deliveryReceiptReceived).then(function(b){return h(a,b)});else return g(a,c,b("ArmadilloDataTraceCheckPoint.bs").advancedCryptoMEMSendTaskComplete).then(function(c){if(b("MAWGating.bs").isDualSendWebOrCrossApp(void 0))return h(a,c);else return window.Promise.resolve(void 0)})}f.call=a}),null);
__d("MAWBridgeUploadAttachmentHandler.bs",["LS.bs","LSIssueAttachmentBackupTask"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("LSIssueAttachmentBackupTask")(c.deliveryObjectId,c.productType,c.mediaType,b("LS.bs").make(a))}f.call=a}),null);
__d("MAWBridgeUploadMessageHandler.bs",["LS.bs","LSUploadMessage","MAWTimeUtils.bs"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("LSUploadMessage")(c.threadId,c.messageId,b("MAWTimeUtils.bs").toTimestamp(c.ts),c.echoDocument,b("LS.bs").make(a))}f.call=a}),null);
__d("MAWBridgeUploadThreadHandler.bs",["LS.bs","LSUploadThread","MAWTimeUtils.bs"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("LSUploadThread")(c.threadId,c.folderType,c.transportKey,b("MAWTimeUtils.bs").toTimestamp(c.ts),c.echoDocument,b("LS.bs").make(a))}f.call=a}),null);
__d("MAWBridgeUIEventHandler.bs",["LSTransaction.bs","MAWBridgeAbPropsUpdatedHandler.bs","MAWBridgeCallFinishAddDeviceHandler.bs","MAWBridgeClockSkewUpdatedHandler.bs","MAWBridgeDeleteReactionHandler.bs","MAWBridgeDropAllSecureThreadsHandler.bs","MAWBridgeGroupInfoUpdatedHandler.bs","MAWBridgeInitSyncCompleteHandler.bs","MAWBridgeMediaExpiredHandler.bs","MAWBridgeMsgClearCountdownHandler.bs","MAWBridgeMsgExpiredHandler.bs","MAWBridgeMsgUpdatedHandler.bs","MAWBridgeMsgsLoadedHandler.bs","MAWBridgeMsgsStartCountdownHandler.bs","MAWBridgeNewMediaHandler.bs","MAWBridgeNewMediaRangeHandler.bs","MAWBridgeNewMsgHandler.bs","MAWBridgeParticipantRemovedHandler.bs","MAWBridgeParticipantUpdatedHandler.bs","MAWBridgeReactionUpsertHandler.bs","MAWBridgeReceivedChatStateHandler.bs","MAWBridgeReceivedReceiptHandler.bs","MAWBridgeStartTraceHandler.bs","MAWBridgeSyncContacts.bs","MAWBridgeThreadBumpedHandler.bs","MAWBridgeThreadHiddenHandler.bs","MAWBridgeThreadTimestampsHandler.bs","MAWBridgeThreadUpdatedHandler.bs","MAWBridgeThreadsLoadedHandler.bs","MAWBridgeUpdateTraceHandler.bs","MAWBridgeUploadAttachmentHandler.bs","MAWBridgeUploadMessageHandler.bs","MAWBridgeUploadThreadHandler.bs","MAWGating.bs","Promise","bs_curry","cr:9875","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";function a(a,c){a=a.then(function(a){return b("LSTransaction.bs").run(a,function(a){var d=b("MAWGating.bs").isArmadillo(void 0)&&b("MAWGating.bs").isDualSendWebOrCrossApp(void 0)?(b("recoverableViolation")("User is both part of armadillo QE and dual send QE","messenger_web_product"),function(a){return b("Promise").resolve(void 0)}):b("MAWGating.bs").isArmadillo(void 0)?function(c){switch(c.TAG|0){case 0:return b("MAWBridgeNewMsgHandler.bs").call(a,c._0);case 1:return b("MAWBridgeMsgExpiredHandler.bs").call(a,c._0);case 2:return b("MAWBridgeMsgsStartCountdownHandler.bs").call(a,c._0);case 3:return b("MAWBridgeMsgClearCountdownHandler.bs").call(c._0);case 4:return b("MAWBridgeDropAllSecureThreadsHandler.bs").call(a);case 5:return b("bs_curry")._2(b("cr:9875").call,a,c._0);case 6:return b("MAWBridgeMsgUpdatedHandler.bs").call(a,c._0);case 7:return b("MAWBridgeNewMediaHandler.bs").call(a,c._0);case 8:return b("MAWBridgeNewMediaRangeHandler.bs").call(a,c._0);case 9:return b("MAWBridgeMediaExpiredHandler.bs").call(a,c._0);case 10:return b("MAWBridgeParticipantUpdatedHandler.bs").call(a,c._0);case 11:return b("MAWBridgeParticipantRemovedHandler.bs").call(a,c._0);case 12:return b("MAWBridgeReceivedReceiptHandler.bs").call(a,c._0);case 13:return b("MAWBridgeThreadUpdatedHandler.bs").call(a,c._0);case 14:return b("MAWBridgeGroupInfoUpdatedHandler.bs").call(a,c._0);case 15:return b("MAWBridgeThreadBumpedHandler.bs").call(a,c._0);case 16:return b("MAWBridgeThreadsLoadedHandler.bs").call(a,c._0);case 17:return b("MAWBridgeThreadTimestampsHandler.bs").call(a,c._0);case 18:return b("MAWBridgeMsgsLoadedHandler.bs").call(a,c._0);case 19:return b("MAWBridgeInitSyncCompleteHandler.bs").call(a);case 20:return b("MAWBridgeStartTraceHandler.bs").call(a,c._0);case 21:return b("MAWBridgeUpdateTraceHandler.bs").call(a,c._0);case 22:return b("MAWBridgeThreadHiddenHandler.bs").call(a,c._0);case 23:return b("MAWBridgeSyncContacts.bs").call(a,c._0);case 24:return b("MAWBridgeReceivedChatStateHandler.bs").call(a,c._0);case 25:return b("MAWBridgeClockSkewUpdatedHandler.bs").call(a,c._0);case 26:return b("MAWBridgeAbPropsUpdatedHandler.bs").call(c._0);case 27:return b("MAWBridgeReactionUpsertHandler.bs").call(a,c._0);case 28:return b("MAWBridgeDeleteReactionHandler.bs").call(a,c._0);case 29:return b("MAWBridgeUploadMessageHandler.bs").call(a,c._0);case 30:return b("MAWBridgeUploadThreadHandler.bs").call(a,c._0);case 31:return b("MAWBridgeCallFinishAddDeviceHandler.bs").call(a,c._0);case 32:return b("MAWBridgeUploadAttachmentHandler.bs").call(a,c._0)}}:b("MAWGating.bs").isDualSendWebOrCrossApp(void 0)?function(c){switch(c.TAG|0){case 20:var d=c._0,e=d.ts,f=d.externalId,g=d.threadType,h=d.type_,i=d.ack;d=d.openMessageOtid;e={ts:e,externalId:f,threadType:g,type_:h,ack:i,isDS:!0,openMessageOtid:d};return b("MAWBridgeStartTraceHandler.bs").call(a,e);case 21:return b("MAWBridgeUpdateTraceHandler.bs").call(a,c._0);case 23:return b("MAWBridgeSyncContacts.bs").call(a,c._0);default:return b("Promise").resolve(void 0)}}:(b("recoverableViolation")("User is neither part of armadillo QE and dual send QE but somehow loaded this handler","messenger_web_product"),function(a){return b("Promise").resolve(void 0)});return c.reduce(function(a,c){return a.then(function(a){return b("bs_curry")._1(d,c)})},b("Promise").resolve(void 0))},"readWrite")});b("promiseDone")(a,void 0,function(a){b("recoverableViolation")("Error handling UI Event","messenger_web_product",{error:a.Error})})}f.$MAWBridgeOccamadilloVerifyThreadExistsHandler$OR$MAWBridgeVerifyThreadExistsHandler$requireCond=b("cr:9875");f.handleEvents=a}),null);
__d("MAWBridgeUIEventHandler.re",["MAWBridgeUIEventHandler.bs"],(function(a,b,c,d,e,f){var g={"-7":0,"-6":1,"-5":2,"-4":3,"-3":4,"-2":5,"-1":6,0:7,1:8,2:9,3:10,4:11},h={User:0,Group:1};a=function(a,c){a=b("MAWBridgeUIEventHandler.bs").handleEvents(a,c.map(function(a){return a.tag==="NewMsg"?{TAG:0,_0:{ts:a.value.ts,chatId:a.value.chatId,rowId:a.value.rowId,msgId:a.value.msgId,sender:a.value.sender,isAdminMessage:a.value.isAdminMessage,content:a.value.content,ack:g[a.value.ack],type_:a.value.type_,adminType:a.value.adminType,adminContent:a.value.adminContent,offlineMsg:a.value.offlineMsg,isAuthorMe:a.value.isAuthorMe,isForwarded:a.value.isForwarded,originalTs:a.value.originalTs,replySnippet:a.value.replySnippet,replyMessageText:a.value.replyMessageText,replySourceId:a.value.replySourceId,replyToUserId:a.value.replyToUserId,replySourceTimestampMs:a.value.replySourceTimestampMs,replyStatusType:a.value.replyStatusType,replyMediaExpirationTimestampMs:a.value.replyMediaExpirationTimestampMs,replyMediaUrl:a.value.replyMediaUrl,replyMediaPreviewWidth:a.value.replyMediaPreviewWidth,replyMediaPreviewHeight:a.value.replyMediaPreviewHeight,replyMediaUrlMimeType:a.value.replyMediaUrlMimeType,replyMediaUrlFallback:a.value.replyMediaUrlFallback,replyCtaId:a.value.replyCtaId,replyCtaTitle:a.value.replyCtaTitle,replyAttachmentId:a.value.replyAttachmentId,replySenderIsMe:a.value.replySenderIsMe,ephemeralDurationInSec:a.value.ephemeralDurationInSec}}:a.tag==="MsgExpired"?{TAG:1,_0:a.value}:a.tag==="MsgsStartCountdown"?{TAG:2,_0:a.value}:a.tag==="MsgClearCountdown"?{TAG:3,_0:a.value}:a.tag==="DropAllSecureThreads"?{TAG:4,_0:a.value}:a.tag==="VerifyThreadExists"?{TAG:5,_0:a.value}:a.tag==="MsgUpdated"?{TAG:6,_0:{ts:a.value.ts,chatId:a.value.chatId,rowId:a.value.rowId,msgId:a.value.msgId,sender:a.value.sender,isAdminMessage:a.value.isAdminMessage,content:a.value.content,ack:g[a.value.ack],type_:a.value.type_,adminType:a.value.adminType,adminContent:a.value.adminContent,offlineMsg:a.value.offlineMsg,isAuthorMe:a.value.isAuthorMe,isForwarded:a.value.isForwarded,originalTs:a.value.originalTs,replySnippet:a.value.replySnippet,replyMessageText:a.value.replyMessageText,replySourceId:a.value.replySourceId,replyToUserId:a.value.replyToUserId,replySourceTimestampMs:a.value.replySourceTimestampMs,replyStatusType:a.value.replyStatusType,replyMediaExpirationTimestampMs:a.value.replyMediaExpirationTimestampMs,replyMediaUrl:a.value.replyMediaUrl,replyMediaPreviewWidth:a.value.replyMediaPreviewWidth,replyMediaPreviewHeight:a.value.replyMediaPreviewHeight,replyMediaUrlMimeType:a.value.replyMediaUrlMimeType,replyMediaUrlFallback:a.value.replyMediaUrlFallback,replyCtaId:a.value.replyCtaId,replyCtaTitle:a.value.replyCtaTitle,replyAttachmentId:a.value.replyAttachmentId,replySenderIsMe:a.value.replySenderIsMe,ephemeralDurationInSec:a.value.ephemeralDurationInSec}}:a.tag==="NewMedia"?{TAG:7,_0:a.value}:a.tag==="NewMediaRange"?{TAG:8,_0:a.value}:a.tag==="MediaExpired"?{TAG:9,_0:a.value}:a.tag==="ParticipantUpdated"?{TAG:10,_0:a.value}:a.tag==="ParticipantRemoved"?{TAG:11,_0:a.value}:a.tag==="ReceivedReceipt"?{TAG:12,_0:a.value}:a.tag==="ThreadUpdated"?{TAG:13,_0:a.value}:a.tag==="GroupInfoUpdated"?{TAG:14,_0:a.value}:a.tag==="ThreadBumped"?{TAG:15,_0:a.value}:a.tag==="ThreadsLoaded"?{TAG:16,_0:a.value}:a.tag==="ThreadTimestampsUpdated"?{TAG:17,_0:a.value}:a.tag==="MsgsLoaded"?{TAG:18,_0:a.value}:a.tag==="InitSyncComplete"?{TAG:19,_0:a.value}:a.tag==="StartTrace"?{TAG:20,_0:{ts:a.value.ts,externalId:a.value.externalId,threadType:h[a.value.threadType],type_:a.value.type_,ack:g[a.value.ack],isDS:a.value.isDS,openMessageOtid:a.value.openMessageOtid}}:a.tag==="UpdateTrace"?{TAG:21,_0:a.value}:a.tag==="ThreadHidden"?{TAG:22,_0:a.value}:a.tag==="SyncContacts"?{TAG:23,_0:a.value}:a.tag==="ReceivedChatState"?{TAG:24,_0:a.value}:a.tag==="ClockSkewUpdated"?{TAG:25,_0:a.value}:a.tag==="ABPropsUpdated"?{TAG:26,_0:a.value}:a.tag==="UpsertReaction"?{TAG:27,_0:a.value}:a.tag==="DeleteReaction"?{TAG:28,_0:a.value}:a.tag==="UploadMessage"?{TAG:29,_0:a.value}:a.tag==="UploadThread"?{TAG:30,_0:a.value}:a.tag==="CallFinishAddDevice"?{TAG:31,_0:a.value}:{TAG:32,_0:a.value}}));return a};f.handleEvents=a}),null);
__d("MAWSetupMutex",["FBLogger","LocalStorageMutex","MAWAppMutex","MAWBridge","MAWDetectDbSupport","MAWEncyptionIndexedDb","MAWIndexedDb","MAWKeychainInit","MAWLocalStorage","MWChatBadgeCountUpdates.re","QPLUserCountEvent","QPLUserFlow","Run","WALogger","qpl","react","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Shouldn't reinitialize, worker already exists"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Reinitializing"]);i=function(){return a};return a}a=d("react");var j=a.useCallback,k=a.useEffect,l=a.useMemo,m=c("FBLogger")("messenger_e2ee_web");e=function(a,e,f){var g=f.doesWorkerExist,n=f.getOrSetupWorker,o=f.setupBridge,p=f.terminateWorker,q=l(function(){return d("MAWAppMutex").use()},[]),r=j(function(a){var b=q.takeoverFilter(a);b&&a.newValue!==d("LocalStorageMutex").THIS_TAB&&a.newValue!==""&&(d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"DropAllSecureThreads",value:void 0}]}),p(),q.onMutexDeath())},[q,p]),s=j(function(){p(),q.onMutexDeath()},[q,p]),t=j(function(){var f,j,k,l,p,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:if(!(document.visibilityState==="visible")){t.next=44;break}f=g();t.next=4;return b("regeneratorRuntime").awrap(c("MAWDetectDbSupport")());case 4:j=t.sent;k=d("MAWLocalStorage").isLocalStorageAvailable();if(!(!f&&j&&k)){t.next=43;break}c("QPLUserFlow").start(c("qpl")._(25310984,"169"));t.next=10;return b("regeneratorRuntime").awrap(q.init());case 10:l=t.sent;if(!l){t.next=40;break}d("WALogger").LOG(i());d("MAWEncyptionIndexedDb").makeEncryptionDB(e);t.next=16;return b("regeneratorRuntime").awrap(d("MAWKeychainInit").initSetupKeychain());case 16:p=t.sent;d("MAWIndexedDb").makeDB(e);if(!p.success){t.next=37;break}t.prev=19;t.next=22;return b("regeneratorRuntime").awrap(n(e,p.value));case 22:r=t.sent;t.next=25;return b("regeneratorRuntime").awrap(o({environment:a,worker:r}));case 25:s=t.sent;t.next=28;return b("regeneratorRuntime").awrap(s.sendAndReceive("backend","initSync",{numMsgsPerThread:10,numThreads:d("MWChatBadgeCountUpdates.re").minSyncedThreads}));case 28:t.next=35;break;case 30:t.prev=30,t.t0=t["catch"](19),m.mustfix("AppMutex - failed to reinitialize worker"),m.catching(t.t0),c("QPLUserFlow").endFailure(c("qpl")._(25310984,"169"),"failed_to_reinitialize_worker");case 35:t.next=38;break;case 37:c("QPLUserFlow").endFailure(c("qpl")._(25310984,"169"),"mutex_keychain_setup_failure_on_reinit");case 38:t.next=41;break;case 40:c("QPLUserFlow").endFailure(c("qpl")._(25310984,"169"),"mutex_no_premission_on_reinit");case 41:t.next=44;break;case 43:f?d("WALogger").DEV(h()):!j?d("QPLUserCountEvent").fireQplUserCount(c("qpl")._(25299354,"201")):k||d("QPLUserCountEvent").fireQplUserCount(c("qpl")._(25309925,"203"));case 44:case"end":return t.stop()}},null,this,[[19,30]])},[a,e,q,g,n,o]);k(function(){window.addEventListener("storage",r);var a=c("Run").onBeforeUnload(s,!1),b=c("Run").onUnload(s);window.addEventListener("visibilitychange",t);return function(){window.removeEventListener("storage",r),a.remove(),b.remove(),window.removeEventListener("visibilitychange",t)}},[r,s,t])};g.useMutex=e}),98);
__d("MAWSetupMutex.react",["MAWSetupMutex","react"],(function(a,b,c,d,e,f,g){"use strict";d("react");function a(a){var b=a.environment,c=a.fbId;a=a.platformSetupUtils;d("MAWSetupMutex").useMutex(b,c,a);return null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("WorkerBundleResource",["createTrustedScriptURLForWebWorker","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var d,e;for(var f=arguments.length,g=new Array(f>2?f-2:0),h=2;h<f;h++)g[h-2]=arguments[h];var i=(d=b)!=null?d:a.name,j=new window.URL(a.url,window.location.href).href;if(j==null){var k=new Error("Can't start up worker without a resource url.");k.stack;throw k}var l=new Blob(["__DEV__=false;","importScripts('"+j+"');","StartBundle.apply(null, "+JSON.stringify([a].concat((e=g)!=null?e:[]))+")"],{type:"text/javascript"});if(c("justknobx")._("316")){var m;l=new Blob(["__DEV__=false;","if (self.trustedTypes && self.trustedTypes.createPolicy) {","const escapeScriptURLPolicy = self.trustedTypes.createPolicy('workerPolicy', {\n    createScriptURL: url => url });","importScripts(escapeScriptURLPolicy.createScriptURL('"+j+"'));","} else {","importScripts('"+j+"');","}","StartBundle.apply(null, "+JSON.stringify([a].concat((m=g)!=null?m:[]))+")"],{type:"text/javascript"})}var n=window.URL.createObjectURL(l),o=new Worker(c("createTrustedScriptURLForWebWorker")(n),{name:i}),p=o.terminate;o.terminate=function(){window.URL.revokeObjectURL(this._objectURL),p.apply(this,arguments)};return o}function b(a,b){b=(b=b)!=null?b:a.name;b=new SharedWorker(c("createTrustedScriptURLForWebWorker")(a.url),{name:b});b.port.start();b.port.postMessage({type:"execute-worker",args:[a]});return b}g.createDedicatedWebWorker=a;g.createSharedWebWorker=b}),98);
__d("WorkerBanzaiLazyQueueChannelClient",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").exportChannel(c("BanzaiLazyQueue"),a,"banzai_lazyqueue_channel")}g.init=a}),98);
__d("WorkerQPLChannel",["WorkerFuncChannel","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WorkerFuncChannel").WorkerFuncChannel)(function(a){return{markerStartFromNavStart:null,markerStart:function(b,d,e){e===void 0&&(e=c("performanceAbsoluteNow")());return a.markerStart(b,d,e)},markerAnnotate:function(b,c,d){return a.markerAnnotate(b,c,d)},markerPoint:function(b,d,e){e=(e==null?void 0:e.timestamp)===void 0?babelHelpers["extends"]({},e,{timestamp:c("performanceAbsoluteNow")()}):e;return a.markerPoint(b,d,e)},markerEnd:function(b,d,e,f){f===void 0&&(f=c("performanceAbsoluteNow")());return a.markerEnd(b,d,e,f)}}},"qpl");function a(a){h.setMessagePort(a)}function b(a){h.setBackend(a)}e=babelHelpers["extends"]({},h.proxyMethods,{setMessagePort:a,initQPL:b});g["default"]=e}),98);
__d("WorkerClient",["WorkerBanzaiLazyQueueChannelClient","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"client","worker"),d("WorkerBanzaiLazyQueueChannelClient").init(a),c("WorkerQPLChannel").setMessagePort(a),e(["QuickPerformanceLogger"],function(a){return c("WorkerQPLChannel").initQPL(a)})}g.init=a}),98);
__d("LiveProducerLP2PollingTabRootQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="3873611566083488"}),null);